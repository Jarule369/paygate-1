openapi: 3.0.2
info:
  description: |
    Paygate is a RESTful API enabling Automated Clearing House ([ACH](https://en.wikipedia.org/wiki/Automated_Clearing_House)) transfers to be created without a deep understanding of a full NACHA file specification.
  version: v1
  title: Paygate API
  contact:
    url: https://github.com/moov-io/paygate
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8082
    description: Local development

tags:
  - name: Tenants
    description: |
      Tenant objects represent a group of Organizations under one legal entity. Typically this is for a vendor who is reselling ACH services to many companies and assigns an Organization for each of their clients,
  - name: Organizations
    description: |
      Organization objects represent an group or large unit that initiates ACH transfers. These are typically businesses or business units who have configurations for their financial institution. The API allows you to create, delete, and update your organizations.
  - name: Transfers
    description: |
      Transfer objects create a transaction initiated by an originator to a receiver with a defined flow and fund amount. The API allows you to create or delete a transfers while the status of the transfer is pending.

paths:
  # Tenants
  /tenants:
    get:
      tags: [Tenants]
      summary: Get Tenants
      description: Retrieve all Tenants for the given user ID
      operationId: getTenants
      parameters:
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      responses:
        '200':
          description: List of Tenants for the given user ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenants'
        '400':
          description: Problem getting Tenants, see error(s)
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'
    post:
      tags: [Tenants]
      summary: Create Tenant
      description: Create a new Tenant under PayGate
      operationId: createTenant
      parameters:
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
              schema:
                $ref: '#/components/schemas/CreateTenant'
      responses:
        '200':
          description: Created Tenant successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tenant'
        '400':
          description: Problem creating Tenant, see error(s)
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'
  # Organizations
  /organizations:
    get:
      tags: [Organizations]
      summary: Get Organizations
      description: Retrieve all Organizations for the given user ID
      operationId: getOrganizations
      parameters:
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      responses:
        '200':
          description: List of Organizations for the given user ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organizations'
        '400':
          description: Problem getting Organizatios, see error(s)
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'
    post:
      tags: [Organizations]
      summary: Create Organization
      description: Create a new Organization under PayGate
      operationId: createOrganization
      parameters:
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
              schema:
                $ref: '#/components/schemas/CreateOrganization'
      responses:
        '200':
          description: Created Organization successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
        '400':
          description: Problem creating Organization, see error(s)
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'
  # Transfers
  /transfers:
    get:
      tags: [Transfers]
      summary: List Transfers
      description: List all Transfers created for the given userID.
      operationId: getTransfers
      parameters:
        - name: offset
          in: query
          required: false
          description: The number of items to skip before starting to collect the result set
          schema:
            type: integer
            minimum: 1
            default: 0
        - name: limit
          in: query
          description: The number of items to return
          required: false
          schema:
            type: integer
            minimum: 0
            maximum: 100
            default: 25
            example: 10
        - name: status
          in: query
          description: Return only Transfers in this TransferStatus
          required: false
          schema:
            $ref: '#/components/schemas/TransferStatus'
        - name: startDate
          in: query
          description: |
            Return Transfers that are scheduled for this date or later in ISO-8601 format YYYY-MM-DD. Can optionally be used with endDate to specify a date range.
          schema:
            type: string
            format: date-time
            example: 2006-01-02T15:04:05Z07:00
        - name: endDate
          in: query
          description: |
            Return Transfers that are scheduled for this date or earlier in ISO-8601 format YYYY-MM-DD. Can optionally be used with startDate to specify a date range.
          schema:
            type: string
            format: date-time
            example: 2006-01-02T15:04:05Z07:00
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      responses:
        '200':
          description: A list of Transfer objects
          headers:
            X-Total-Count:
              description: The total number of Transfers
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transfers'
    post:
      tags: [Transfers]
      summary: Create Transfer
      description: Create a new transfer between an Originator and a Receiver. Transfers cannot be modified. Instead delete the old and create a new transfer.
      operationId: addTransfer
      parameters:
        - name: X-Idempotency-Key
          in: header
          description: Idempotent key in the header which expires after 24 hours. These strings should contain enough entropy for to not collide with each other in your requests.
          example: a4f88150
          required: false
          schema:
            type: string
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTransfer'
      responses:
        '201':
          description: Created
          headers:
            Location:
              description: The location of the new resource
              schema:
                type: string
                format: uri
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transfer'
        '400':
          description: "Invalid Transfer Object"
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'
  /transfers/{transferID}:
    get:
      tags: [Transfers]
      summary: Get Transfer
      description: Get a Transfer object for the supplied userID
      operationId: getTransferByID
      parameters:
        - name: transferID
          in: path
          description: Transfer ID
          required: true
          schema:
            type: string
            example: 33164ac6
        - name: offset
          in: query
          required: false
          description: The number of items to skip before starting to collect the result set
          schema:
            type: integer
            minimum: 1
            default: 0
        - name: limit
          in: query
          description: The number of items to return
          required: false
          schema:
            type: integer
            minimum: 0
            maximum: 100
            default: 25
            example: 10
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      responses:
        '200':
          description: A transfer object for the supplied ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transfer'
        '404':
          description: A resource object with the specified ID was not found.
    delete:
      tags: [Transfers]
      summary: Delete Transfer
      description: |
        Remove a transfer for the specified userID. Its status will be updated as transfer is processed.
        It is only possible to delete (recall) a Transfer before it has been released from the financial institution.
      operationId: deleteTransferByID
      parameters:
        - name: transferID
          in: path
          description: Transfer ID
          required: true
          schema:
            type: string
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
      responses:
        '200':
          description: Transfer has been deleted.
        '404':
          description: A transfer with the specified ID was not found.
  /transfers/{transferID}/failed:
    post:
      tags: [Transfers]
      summary: Validate Transfer
      description: Get the NACHA return code and description of the underlying ACH file for this transfer.
      operationId: getTransferNachaCode
      parameters:
        - name: transferID
          in: path
          description: Transfer ID
          required: true
          schema:
            type: string
            example: 33164ac6
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
        - name: X-Idempotency-Key
          in: header
          description: Idempotent key in the header which expires after 24 hours. These strings should contain enough entropy for to not collide with each other in your requests.
          example: a4f88150
          required: false
          schema:
            type: string
      responses:
        '200':
          description: See ACH file(s) for ReturnCode, ChangeCode, or other structures.
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/ach/master/openapi.yml#/components/schemas/Files'
        '400':
          description: ACH file failed validation, check response body.
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'
        '404':
          description: Returned if no errors were found.
  /transfers/{transferID}/files:
    post:
      tags: [Transfers]
      summary: Get Transfer Files
      description: Get the ACH files to be used in this transfer
      operationId: getTransferFiles
      parameters:
        - name: transferID
          in: path
          description: Transfer ID
          required: true
          schema:
            type: string
            example: 33164ac6
        - name: X-Request-ID
          in: header
          description: Optional Request ID allows application developer to trace requests through the systems logs
          example: rs4f9915
          schema:
            type: string
        - name: X-User-ID
          in: header
          required: true
          description: Moov User ID
          schema:
            type: string
        - name: X-Idempotency-Key
          in: header
          description: Idempotent key in the header which expires after 24 hours. These strings should contain enough entropy for to not collide with each other in your requests.
          example: a4f88150
          required: false
          schema:
            type: string
      responses:
        '200':
          description: The ACH files generated for a transfer.
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/ach/master/openapi.yml#/components/schemas/Files'
        '400':
          description: Problem getting ACH files, check response body.
          content:
            application/json:
              schema:
                $ref: 'https://raw.githubusercontent.com/moov-io/api/master/openapi-common.yaml#/components/schemas/Error'

components:
  schemas:
    CreateTenant:
      description: ''
      properties:
        name:
          type: string
          example: My Company
          description: ''
        primaryCustomer:
          type: string
          example: 11ffa67d
          description: |
            Customer ID to use in Transfers with this Tenant. When transfering to or from the Tenant this Customer and Account(s) are used.
            The Customer assigned here should represent the legal entity that manages the Tenant.
    Tenant:
      properties:
        name:
          type: string
          example: My Company
          description: ''
    Tenants:
      type: array
      items:
        $ref: '#/components/schemas/Tenant'
    CreateOrganization:
      description: ''
      properties:
        name:
          type: string
          example: My Organization
          description: ''
        primaryCustomer:
          type: string
          example: 11ffa67d
          description: |
            Customer ID to use in Transfers with this Organization. When transfering to or from the Organization this Customer and Account(s) are used.
            The Customer assigned here should represent the legal entity that manages the Organization.
    Organization:
      properties:
        name:
          type: string
          example: My Organization
          description: ''
    Organizations:
      type: array
      items:
        $ref: '#/components/schemas/Organization'
    Source:
      description: Customer that initiates a Transfer
      properties:
        customerID:
          type: string
          example: d47a1b20
          description: Customer ID used as source for this Transfer
        accountID:
          type: string
          example: 68b534b7
          description: Optional Account ID used for this Transfer. If the Customer only has one account this value can be left empty.
      required:
        - customerID
    Destination:
      description: Customer that is receiving a Transfer
      properties:
        customerID:
          type: string
          example: d47a1b20
          description: Customer ID used as source for this Transfer
        accountID:
          type: string
          example: 68b534b7
          description: Optional Account ID used for this Transfer. If the Customer only has one account this value can be left empty.
      required:
        - customerID
    CreateTransfer:
      description: |
        These fields are used to initiate a Transfer from an Originator to a Receiver using the two Depository objects.
        CCDDetail, IATDetail, etc are only required according to the Standard Entry Class (SEC) code used.
      properties:
        transferType:
          type: string
          enum:
            - "push"
            - "pull"
          example: "push"
          description: Type of transaction being actioned against the receiving institution. Expected values are pull (debits) or push (credits).
        amount:
          type: string
          format: currency
          example: "USD 99.99"
          description: Amount of money. USD - United States.
        source:
          $ref: '#/components/schemas/Source'
        destination:
          $ref: '#/components/schemas/Destination'
        description:
          type: string
          description: Brief description of the transaction, that may appear on the receiving entity’s financial statement
          example: Loan Pay
          minLength: 1
          maxLength: 79
        standardEntryClassCode:
          type: string
          description: Standard Entry Class code will be generated based on Receiver type for CCD and PPD
          example: WEB
        sameDay:
          type: boolean
          default: false
          description: When set to true this indicates the transfer should be processed the same day if possible.
        CCDDetail:
          $ref: '#/components/schemas/CCDDetail'
        IATDetail:
          $ref: '#/components/schemas/IATDetail'
        PPDDetail:
          $ref: '#/components/schemas/PPDDetail'
        TELDetail:
          $ref: '#/components/schemas/TELDetail'
        WEBDetail:
          $ref: '#/components/schemas/WEBDetail'
      required:
        - transferType
        - amount
        - receiver
        - originator
        - description
    CreateTransfers:
      type: array
      items:
        $ref: '#/components/schemas/CreateTransfer'
    TransferStatus:
      type: string
      description: Defines the state of the Transfer
      enum:
        - canceled
        - failed
        - reviewable
        - pending
        - processed
    Transfer:
      properties:
        ID:
          type: string
          description: Optional ID to uniquely identify this transfer. If omitted, one will be generated
          example: 33164ac6
        transferType:
          type: string
          enum:
            - "push"
            - "pull"
          example: "push"
          description: Type of transaction being actioned against the receiving institution. Expected values are pull (debits) or push (credits). Only one period used to signify decimal value will be included.
        amount:
          type: string
          format: currency
          example: "USD 99.99"
          description: Amount of money. USD - United States.
        source:
          $ref: '#/components/schemas/Source'
        destination:
          $ref: '#/components/schemas/Destination'
        description:
          type: string
          description: Brief description of the transaction, that may appear on the receiving entity’s financial statement
          example: Loan Pay
          minLength: 1
          maxLength: 79
        standardEntryClassCode:
          type: string
          description: Standard Entry Class code will be generated based on Receiver type for CCD and PPD
          example: WEB
        status:
          $ref: '#/components/schemas/TransferStatus'
        sameDay:
          type: boolean
          default: false
          description: When set to true this indicates the transfer should be processed the same day if possible.
        returnCode:
          $ref: '#/components/schemas/ReturnCode'
        created:
          type: string
          format: date-time
          example: 2006-01-02T15:04:05Z07:00
        CCDDetail:
          $ref: '#/components/schemas/CCDDetail'
        IATDetail:
          $ref: '#/components/schemas/IATDetail'
        PPDDetail:
          $ref: '#/components/schemas/PPDDetail'
        TELDetail:
          $ref: '#/components/schemas/TELDetail'
        WEBDetail:
          $ref: '#/components/schemas/WEBDetail'
      required:
        - type
        - amount
        - receiver
        - originator
        - description
    Transfers:
      type: array
      items:
        $ref: '#/components/schemas/Transfer'
    ReturnCode:
      properties:
        code:
          type: string
          description: Optional NACHA return code for this Transfer
          example: R02
        reason:
          type: string
          description: Short NACHA description of return code
          example: Account Closed
        description:
          type: string
          description: Long form explanation of return code
          example: Previously active account has been closed by customer or RDFI
    CCDDetail:
      properties:
        paymentInformation:
          type: string
          description: Metadata for the transaction, placed in addenda 05 record
          example: test payment
      required:
        - paymentInformation
    IATDetail:
      properties:
        originatorName:
          type: string
          description: Name of originating entity
          example: Jane Doe
        originatorAddress:
          type: string
          description: Address of originating entity
          example: 123 1st St
        originatorCity:
          type: string
          description: City of originating entity
          example: Anytown
        originatorState:
          type: string
          description: State of originating entity
          example: PA
        originatorPostalCode:
          type: string
          description: Postal code of originating entity
          example: "12345"
        originatorCountryCode:
          type: string
          description: ISO 3166 Country code of originating entity
          example: US
        ODFIName:
          type: string
          description: Name of originating financial institution
          example: My Bank
        ODFIIDNumberQualifier:
          type: string
          description: ID qualifier number of originating FI
          example: "01"
        ODFIIdentification:
          type: string
          description: Identification of originating FI
          example: "141451"
        ODFIBranchCurrencyCode:
          type: string
          description: ISO 4217 currency code of originating entity
          example: USD
        receiverName:
          type: string
          description: Name of receiving entity
          example: John Doe
        receiverAddress:
          type: string
          description: Address of originating entity
          example: 321 2nd St
        receiverCity:
          type: string
          description: City of originating entity
          example: Othertown
        receiverState:
          type: string
          description: State of originating entity
          example: GB
        receiverPostalCode:
          type: string
          description: Postal code of originating entity
          example: "54321"
        receiverCountryCode:
          type: string
          description: ISO 3166 country code of originating entity
          example: GB
        RDFIName:
          type: string
          description: Name of receiving financial institution
          example: Their Bank
        RDFIIDNumberQualifier:
          type: string
          description: ID qualifier number of originating FI
          example: "01"
        RDFIIdentification:
          type: string
          description: Identification of receiving financial institution
          example: "4"
        RDFIBranchCurrencyCode:
          type: string
          description: ISO 4217 currency code of receiving entity
          example: GB
        foreignCorrespondentBankName:
          type: string
          description: Name of foreign bank used in IAT transfer
          example: Their Bank
        foreignCorrespondentBankIDNumberQualifier:
          type: string
          description: ID qualifier of foreign bank used
          example: "5125112"
        foreignCorrespondentBankIDNumber:
          type: string
          description: ID number of foreign bank used
          example: "631551"
        foreignCorrespondentBankBranchCountryCode:
          type: string
          description: ISO 3166 country code of foreign bank used
          example: GB
    PPDDetail:
      properties:
        paymentInformation:
          type: string
          description: Metadata for the transaction, placed in addenda 05 record
          example: test payment
    TELDetail:
      properties:
        phoneNumber:
          type: string
          description: Phone number for optional communication during business hours required for TEL transfers
          example: 123.456.7890
        paymentType:
          type: string
          description: Defines if the transfer is authorized for a single transaction or reoccurring
          enum:
            - "single"
            - "reoccurring"
          example: single
    WEBDetail:
      properties:
        paymentInformation:
          type: string
          description: Metadata for the transaction, placed in addenda 05 record
          example: test payment
        paymentType:
          type: string
          description: Defines if the transfer is authorized for a single transaction or reoccurring
          enum:
            - "single"
            - "reoccurring"
          example: single
